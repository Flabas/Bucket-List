{% extends 'base.html.twig' %}

{% block title %}Modifier "{{ category.name }}" - Bucket-List{% endblock %}

{% block body %}
<div class="py-4 page-enter">
    <!-- Header de la page -->
    <div class="page-header glass-effect p-4 mb-5 position-relative overflow-hidden">
        <div class="header-background"></div>
        <div class="d-flex align-items-center gap-3 position-relative">
            <a href="{{ path('app_category_list') }}"
               class="btn btn-outline-secondary custom-btn-outline hover-scale animate-fade-in-up">
                <i class="fas fa-arrow-left me-2"></i>
                Retour
            </a>
            <h1 class="page-title h2 mb-0 d-flex align-items-center gap-3 text-gradient animate-fade-in-up" style="animation-delay: 0.1s;">
                <div class="page-icon">
                    <i class="fas fa-edit"></i>
                </div>
                Modifier la catégorie
            </h1>
        </div>
    </div>

    <!-- Informations de la catégorie -->
    <div class="category-info mb-4">
        <div class="card custom-card border-0">
            <div class="card-body p-3">
                <div class="d-flex align-items-center gap-3">
                    <div class="info-icon">
                        <i class="fas fa-folder text-primary"></i>
                    </div>
                    <div>
                        <h6 class="mb-1 text-gradient">Catégorie actuelle</h6>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-primary custom-badge">#{{ category.id }}</span>
                            <span class="fw-semibold">{{ category.name }}</span>
                            <span class="text-muted">• {{ category.wishes|length }} idée(s) associée(s)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulaire de modification -->
    <div class="form-section">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-6">
                <div class="card custom-card border-0 hover-lift">
                    <div class="card-header custom-card-header">
                        <i class="fas fa-pen me-2"></i>
                        Modifier la catégorie
                    </div>
                    <div class="card-body p-4">
                        <form method="post" class="category-form">
                            <input type="hidden" name="_token" value="{{ csrf_token('edit_category_' ~ category.id) }}">

                            <!-- Champ nom -->
                            <div class="form-group mb-4">
                                <label for="name" class="form-label custom-label">
                                    <i class="fas fa-tag me-2"></i>
                                    Nouveau nom de la catégorie
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-folder"></i>
                                    </span>
                                    <input type="text"
                                           id="name"
                                           name="name"
                                           class="form-control custom-input"
                                           placeholder="Entrez le nouveau nom..."
                                           value="{{ category.name }}"
                                           required
                                           maxlength="255"
                                           autocomplete="off">
                                </div>
                                <div class="form-text text-muted mt-2">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Le nom doit être unique et descriptif (maximum 255 caractères)
                                </div>
                            </div>

                            <!-- Aperçu des modifications -->
                            <div class="changes-preview mb-4">
                                <h6 class="text-gradient mb-3">
                                    <i class="fas fa-eye me-2"></i>
                                    Aperçu des modifications
                                </h6>
                                <div class="preview-container p-3 rounded glass-effect">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="before">
                                            <small class="text-muted d-block">Avant</small>
                                            <span class="badge bg-secondary">{{ category.name }}</span>
                                        </div>
                                        <div class="arrow">
                                            <i class="fas fa-arrow-right text-primary"></i>
                                        </div>
                                        <div class="after">
                                            <small class="text-muted d-block">Après</small>
                                            <span class="badge bg-primary custom-badge" id="preview-name">{{ category.name }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Boutons d'action -->
                            <div class="form-actions d-flex gap-3 justify-content-end">
                                <a href="{{ path('app_category_list') }}"
                                   class="btn btn-outline-secondary custom-btn-outline hover-scale">
                                    <i class="fas fa-times me-2"></i>
                                    Annuler
                                </a>
                                <button type="submit"
                                        class="btn btn-primary custom-btn-primary hover-lift"
                                        id="save-btn">
                                    <i class="fas fa-save me-2"></i>
                                    Enregistrer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Zone de danger -->
                <div class="danger-zone mt-4">
                    <div class="card custom-card border-danger">
                        <div class="card-header bg-danger text-white">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Zone de danger
                        </div>
                        <div class="card-body">
                            <h6 class="text-danger mb-2">Supprimer cette catégorie</h6>
                            <p class="text-muted mb-3">
                                Cette action est irréversible. La catégorie sera définitivement supprimée.
                            </p>
                            <form method="post"
                                  action="{{ path('app_category_delete', {'id': category.id}) }}"
                                  class="d-inline"
                                  onsubmit="return confirm('⚠️ ATTENTION ⚠️\n\nÊtes-vous absolument sûr de vouloir supprimer la catégorie « {{ category.name }} » ?\n\nCette action est IRRÉVERSIBLE et supprimera définitivement la catégorie.\n\nTapez « SUPPRIMER » dans le champ ci-dessous pour confirmer :') && prompt('Tapez SUPPRIMER pour confirmer :') === 'SUPPRIMER'">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete_category_' ~ category.id) }}">
                                <button type="submit" class="btn btn-outline-danger hover-scale">
                                    <i class="fas fa-trash me-2"></i>
                                    Supprimer définitivement
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    const previewName = document.getElementById('preview-name');
    const saveBtn = document.getElementById('save-btn');
    const originalName = '{{ category.name }}';

    // Focus et sélection du texte
    nameInput.focus();
    nameInput.select();

    // Mise à jour de l'aperçu en temps réel
    nameInput.addEventListener('input', function() {
        const newName = this.value.trim();
        previewName.textContent = newName || originalName;

        // Validation
        if (newName.length > 0 && newName !== originalName) {
            this.classList.add('is-valid');
            this.classList.remove('is-invalid');
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Enregistrer les modifications';
        } else if (newName === originalName) {
            this.classList.remove('is-valid', 'is-invalid');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-info-circle me-2"></i>Aucune modification';
        } else {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Enregistrer';
        }
    });

    // Validation initiale
    saveBtn.disabled = true;
    saveBtn.innerHTML = '<i class="fas fa-info-circle me-2"></i>Aucune modification';
});
</script>
{% endblock %}
